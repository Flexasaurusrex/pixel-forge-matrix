<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Collage Builder - Retrowave Edition</title>
    <meta name="description" content="Create stunning digital pixel collages with quantum textures, geometric constructs, and retrowave color cycling effects.">
    <meta name="keywords" content="pixel art, collage, retrowave, cyberpunk, digital art, creative tools">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- Mobile Detection and Auto-Redirect -->
    <script>
    (function() {
        // Mobile detection and redirect
        function isMobileDevice() {
            const userAgent = navigator.userAgent.toLowerCase();
            const mobileKeywords = [
                'android', 'iphone', 'ipad', 'ipod', 'blackberry', 
                'windows phone', 'mobile', 'opera mini'
            ];
            
            // Check user agent
            const isMobileUA = mobileKeywords.some(keyword => userAgent.includes(keyword));
            
            // Check screen size (phones typically < 768px width)
            const isSmallScreen = window.innerWidth <= 768;
            
            // Check touch capability
            const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            
            return isMobileUA || (isSmallScreen && isTouchDevice);
        }
        
        // Only redirect if:
        // 1. We're on mobile
        // 2. Not already on mobile path
        // 3. User hasn't opted for desktop version
        if (isMobileDevice() && 
            !window.location.pathname.includes('/mobile') && 
            !localStorage.getItem('forceDesktop')) {
            
            // Show brief message and redirect
            document.addEventListener('DOMContentLoaded', function() {
                document.body.innerHTML = `
                    <div style="
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        height: 100vh;
                        background: #000000;
                        color: #00ff41;
                        font-family: 'Orbitron', monospace;
                        text-align: center;
                        padding: 20px;
                    ">
                        <h2 style="margin-bottom: 20px; text-shadow: 0 0 10px #00ff41;">üöÄ Redirecting to Mobile Version...</h2>
                        <p style="margin-bottom: 30px; opacity: 0.7; color: #ff006e;">Optimized for touch devices</p>
                        <button onclick="stayOnDesktop()" style="
                            background: linear-gradient(135deg, #ff006e, #ff4081);
                            border: 2px solid #ff006e;
                            color: white;
                            padding: 12px 20px;
                            border-radius: 8px;
                            font-family: 'Orbitron', monospace;
                            cursor: pointer;
                            font-size: 14px;
                            transition: all 0.3s ease;
                            box-shadow: 0 0 10px #ff006e;
                        " onmouseover="this.style.boxShadow='0 0 20px #ff006e'" onmouseout="this.style.boxShadow='0 0 10px #ff006e'">Stay on Desktop Version</button>
                    </div>
                `;
                
                // Add function to stay on desktop
                window.stayOnDesktop = function() {
                    localStorage.setItem('forceDesktop', 'true');
                    location.reload();
                };
                
                // Redirect after 2 seconds
                setTimeout(() => {
                    window.location.href = '/mobile';
                }, 2000);
            });
        }
    })();
    </script>
    
    <!-- GIF Library with Worker Fix -->
    <script src="https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.min.js"></script>
    <script>
        // Fix for GIF.js worker CORS issue
        window.gifWorkerReady = false;
        if (typeof GIF !== 'undefined') {
            // Fetch the worker script and create a blob URL to avoid CORS
            fetch('https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.worker.js')
                .then(response => {
                    if (!response.ok) throw new Error('Worker fetch failed');
                    return response.blob();
                })
                .then(blob => {
                    const workerUrl = URL.createObjectURL(blob);
                    // Override the default worker script path
                    const originalGIF = window.GIF;
                    window.GIF = function(options) {
                        options = options || {};
                        options.workerScript = workerUrl;
                        return new originalGIF(options);
                    };
                    // Copy static properties
                    Object.setPrototypeOf(window.GIF, originalGIF);
                    Object.assign(window.GIF, originalGIF);
                    window.gifWorkerReady = true;
                    console.log('‚úÖ GIF worker loaded successfully');
                })
                .catch(error => {
                    console.warn('‚ö†Ô∏è GIF worker failed to load:', error);
                    window.gifWorkerReady = false;
                });
        }
    </script>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>‚óà PIXEL FORGE MATRIX v3.0 ‚óà</h1>
        </div>
        
        <div class="sidebar">
            <h3>‚óÜ QUANTUM TEXTURES ‚óÜ</h3>
            <div class="pixel-library" id="pixelLibrary">
                <!-- Pixel items will be generated here -->
            </div>
            
            <h3>‚óÜ GEOMETRIC CONSTRUCTS ‚óÜ</h3>
            <div class="sprite-library" id="spriteLibrary">
                <!-- Sprite items will be generated here -->
            </div>
            
            <h3>‚óÜ BACKGROUND GENERATORS ‚óÜ</h3>
            <div class="sprite-library" id="patternLibrary">
                <!-- Pattern items will be generated here -->
            </div>
        </div>
        
        <div class="main-canvas">
            <canvas id="canvas" width="800" height="600" style="image-rendering: pixelated;"></canvas>
            <canvas id="gridOverlay" class="grid-overlay" width="800" height="600"></canvas>
        </div>
        
        <div class="tools">
            <div class="tool-section">
                <h4>‚óá TOOLS ‚óá</h4>
                <button class="tool-btn active" id="paintTool">‚óà PAINT</button>
                <button class="tool-btn" id="eraseTool">‚óá ERASE</button>
                <button class="tool-btn" id="fillTool">‚óÜ FILL</button>
                <button class="tool-btn" id="pickTool">‚óâ SAMPLE</button>
                <button class="tool-btn" id="sprayTool">‚Äª SPRAY</button>
            </div>
            
            <div class="tool-section">
                <h4>‚óá HISTORY ‚óá</h4>
                <div class="undo-redo-container">
                    <button class="undo-redo-btn" id="undoBtn" title="Undo (Ctrl+Z)">‚Ü∂ UNDO</button>
                    <button class="undo-redo-btn" id="redoBtn" title="Redo (Ctrl+Y)">‚Ü∑ REDO</button>
                </div>
            </div>
            
            <div class="tool-section">
                <h4>‚óá BRUSH SIZE ‚óá</h4>
                <div class="brush-size">
                    <button class="size-btn active" data-size="1">1</button>
                    <button class="size-btn" data-size="3">3</button>
                    <button class="size-btn" data-size="6">6</button>
                    <button class="size-btn" data-size="12">12</button>
                </div>
            </div>
            
            <div class="tool-section">
                <h4>‚óá SPECTRUM ‚óá</h4>
                <div class="color-picker" id="colorPicker">
                    <!-- Color swatches will be generated here -->
                </div>
            </div>
            
            <div class="tool-section">
                <button class="tool-btn" id="retrowaveBtn">‚óà RETROWAVE</button>
                <button class="tool-btn" id="colorCycleBtn">‚óá COLOR CYCLE</button>
                <button class="tool-btn" id="recordGifBtn">‚óâ RECORD GIF</button>
                <button class="tool-btn" id="randomize">‚óà RANDOMIZE</button>
                <button class="tool-btn" id="clearCanvas">‚óá PURGE</button>
                <button class="tool-btn" id="toggleGrid">‚óÜ GRID</button>
                <button class="tool-btn" id="saveImage">‚óâ EXPORT</button>
            </div>
        </div>
        
        <div class="footer">
            <div class="performance-stats">
                <span>XY: <span id="coords">0, 0</span></span>
                <span>PIXELS: <span id="pixelCount">0</span></span>
                <span>FPS: <span id="fps">60</span></span>
            </div>
            <div class="mode-indicator" id="modeIndicator">PAINT MODE</div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
